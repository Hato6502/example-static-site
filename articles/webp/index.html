<!doctype html>
<html>
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-106651880-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-106651880-2');
    </script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script> (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7008780049786244",
    enable_page_level_ads: true
    });
    </script>

      <meta charset="utf-8">
<title>webp 画像形式でファイルサイズが 92% 削減された - Hood</title>
 <meta name="description" content="webp 画像形式をサイトに導入し、画像の転送負荷を大幅に削減する方法を紹介します。"> <meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@bluehood_admin">
<meta property="og:url" content="https://b-hood.site/articles/webp/">
<meta property="og:title" content="webp 画像形式でファイルサイズが 92% 削減された">
 <meta property="og:description" content="webp 画像形式をサイトに導入し、画像の転送負荷を大幅に削減する方法を紹介します。"> <meta property="og:image" content="https://b-hood.site/storage/articles/images/e18bc26b.jpg">

<link rel="canonical" href="https://b-hood.site/articles/webp/">
<link rel="icon" href="https://b-hood.site/images/favicon@32px.png" sizes="32x32">
<link rel="icon" href="https://b-hood.site/images/favicon@192px.png" sizes="192x192">

    <link href="/css/app.css" rel="stylesheet">
      <link rel="stylesheet" href="https://b-hood.site/css/social-button.css" />
  </head>
  <body>
    <nav>
  <div>
    <a href="https://b-hood.site/"><h1>Hood</h1></a>
    <div class="nav-menu">
      
      <a href="https://b-hood.site/articles/">Articles</a>
      <a href="https://github.com/blue-hood" target="_blank">GitHub</a>
      <a href="https://twitter.com/bluehood_admin" target="_blank">Twitter</a>
      <a href="https://miniblog.bluehood.net" target="_blank">MiniBlog</a>
    </div>
    <div class="hamburger-button">Menu</div>
  </div>
</nav>
      <ol class="breadcrumb">
    <div>
              <li class="breadcrumb-item">
                      <a href="https://b-hood.site/">Hood</a>
                  </li>
              <li class="breadcrumb-item">
                      <a href="https://b-hood.site/articles/">記事一覧</a>
                  </li>
              <li class="breadcrumb-item">
                      webp 画像形式でファイルサイズが 92% 削減された
                  </li>
          </div>
  </ol>

  <article class="articles-show">
    <div>
      <div>2019-05-04</div>
      <h1>webp 画像形式でファイルサイズが 92% 削減された</h1>
      <div class="content">
        <picture>
  <source type="image/webp" srcset="/storage/articles/images/e18bc26b.webp 1x, /storage/articles/images/d857a180.webp 2x">
  <img srcset="/storage/articles/images/e18bc26b.jpg 1x, /storage/articles/images/d857a180.jpg 2x">
</picture>
<p>皆さんこんにちは😀　
私はいま作っているこのサイトでは、<strong>シンプルかつこだわりをもって</strong>あれこれやっているつもりです。
そのひとつとして、Google の <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a>というものを利用しています。
これはページの読み込み速度をスコアリングして、さらにスピードを改善するためのアドバイスもしてくれる素晴らしいツールです。
ページスピードは Web 検索にも影響すると言われ、サイトを運営している方であれば多くの人が活用できるのではないでしょうか？
この記事では、読み込み速度改善の１つとして<strong>webp 画像形式の導入</strong>について紹介したいと思います。</p>
<ol class="table-of-contents"></ol>
<h2>まずはページスピードを測定</h2>
<p>まずは自分の Web サイトの状況を確認するために、<a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a> を使います。
サイトの URL を入力して測定するだけで、数十秒後にはスコアが表示されると思います。
なお、PageSpeed Insights は<strong>モバイル</strong>と <strong>PC</strong> に分けて測定、スコアリングするため、両方確認する必要があります。</p>
<p>私のサイトでは、まず重要な箇所としてランディングページ (LP) の測定をしてみました。
LP には特にコンテンツもなく負荷が軽いので、スコア 90 点超えの良い結果となりました。</p>
<picture>
  <source type="image/webp" srcset="/storage/articles/images/730e4f28.webp">
  <img src="/storage/articles/images/730e4f28.png">
</picture>
<p>しかし、記事一覧ページでは 80 点台という標準的な結果でした。</p>
<picture>
  <source type="image/webp" srcset="/storage/articles/images/3c502d96.webp">
  <img src="/storage/articles/images/3c502d96.png">
</picture>
<p>こんなとき、Google はスピード改善のための提案をしてくれます。
そこに「次世代フォーマットでの画像の配信」というものがありました。
これは、Web サイトに埋め込まれている jpg や png などの形式の画像を、
jpeg2000 や webp という画像形式に置き換えることで通信負荷が抑えられることを意味しています。
さらに、次世代フォーマットを導入することによるファイルサイズの削減量まで教えてくれるといういたわり尽くせリです。</p>
<picture>
  <source type="image/webp" srcset="/storage/articles/images/e6e28656.webp">
  <img src="/storage/articles/images/e6e28656.png">
</picture>
<h2>webp 形式に変換する</h2>
<p>というわけで、さっそく Web サイト中のあらゆる png, jpeg ファイルを webp に変換してみました。
Ubuntu をお使いの方は、以下のコマンドで webp に変換するコマンドをインストールできます。</p>
<pre class="prettyprint">
$ sudo apt install webp
</pre>
<p>そして、以下のコマンドで png, jpeg ファイルを一括で webp ファイルに変換できます。
なお、<code>cwebp</code> コマンドは変換のクオリティーがデフォルトで 80% に設定されています。
コマンドオプションを追加して、クオリティーを変更することも可能です。</p>
<pre class="prettyprint">
for path in *.png *.jpg ; do cwebp ${path} -o ${path%.*}.webp; done
</pre>
<p>webp 形式に変換した結果、どれくらいファイルサイズが削減されたか確認してみます。
シェルで頑張ってファイルサイズの一覧表示をしてみました。</p>
<pre class="prettyprint">
$ for path in *.png *.jpg ;do echo `du -h ${path}`" -> "`du -h ${path%.*}.webp` "("$(( `wc -c < ${path%.*}.webp`*100/`wc -c < ${path}` ))"%)"; done
736K images/1d1900bc.png -> 32K images/1d1900bc.webp (4%)
644K images/c355feaf.png -> 32K images/c355feaf.webp (4%)
140K images/1814cc87.jpg -> 20K images/1814cc87.webp (13%)
944K images/21c8af6c.jpg -> 72K images/21c8af6c.webp (7%)
2.2M images/45e49d86.jpg -> 208K images/45e49d86.webp (9%)
328K images/5b213ef0.jpg -> 40K images/5b213ef0.webp (12%)
2.2M images/62fd5d1b.jpg -> 196K images/62fd5d1b.webp (8%)
360K images/7c38fe6d.jpg -> 56K images/7c38fe6d.webp (14%)
972K images/90f383dd.jpg -> 28K images/90f383dd.webp (2%)
132K images/a92fe036.jpg -> 8.0K images/a92fe036.webp (5%)
300K images/dc698745.jpg -> 36K images/dc698745.webp (11%)
2.2M images/e5b5e4ae.jpg -> 176K images/e5b5e4ae.webp (7%)
</pre>
<p>ファイルサイズが 4%, 4%, 13%, ……に削減されており、平均すると 8%、つまり <strong>92%</strong> もサイズが削減されていることになります。
ちょっとこれだけサイズが減ってしまうと、正常に変換されているのか……？と不安になるレベルですね😮　
私が目視で確認したところだと、若干の劣化は感じるものの十分画像は保たれていますね。
なお、このページやサイトにも webp を導入していますので、みなさんもぜひファイルサイズや画質を確認してみてください。</p>
<h2>従来の画像形式と両対応する</h2>
<p>とても効率が良い webp 画像形式ですが、残念ながら現状では従来の png, jpeg 形式のファイルを残したまま両対応する必要があります。
というのも、一部のメジャーな Web ブラウザでは、webp 画像形式に対応していないからです。</p>
<p>そこで、img タグではなく <a href="https://blog.jxck.io/entries/2016-03-26/webp.html">picture タグを使用</a>して、従来の画像形式と webp の両方をサイトに埋め込みます。
以下のようにすると、webp 対応のブラウザでは webp、非対応のブラウザでは jpeg 画像が読み込まれます。</p>
<pre class="prettyprint linenums">
&lt;picture&gt;
  &lt;source type=&quot;image/webp&quot; srcset=&quot;/storage/articles/images/e18bc26b.webp 1x, /storage/articles/images/d857a180.webp 2x&quot;&gt;
  &lt;img srcset=&quot;/storage/articles/images/e18bc26b.jpg 1x, /storage/articles/images/d857a180.jpg 2x&quot;&gt;
&lt;/picture&gt;
</pre>
<h2>PageSpeed Insights に頼ろう</h2>
<p>webp 形式の驚異的な圧縮効率には私も驚かされました。
なかには 132kB の jpeg ファイルが 8.0kB になってしまうものもあり、もはやテキストファイルと同等になっているような気もします。
webp 形式のことは PageSpeed Insights を通じて知ったのですが、PageSpeed ではその他さまざまな提案をしてくれます。
たとえば画像やビデオのキャッシュを長くするなど、まだまだ改善の余地はありそうです。</p>

        <div id="social"></div>
      </div>
      <h3>この記事の執筆者</h3>
      <div class="author">
        <picture>
          <source type="image/webp" srcset="https://b-hood.site/storage/authors/images/hato6502.webp 1x">
          <img src="https://b-hood.site/storage/authors/images/hato6502.png" alt="hato6502">
        </picture>
        <div>
          <h4>hata
            &emsp;<a href="https://twitter.com/bluehood_admin?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-screen-name="false" data-show-count="false">Follow @bluehood_admin</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            
          </h4>
          <p>
            中学生の頃に 6502 という CPU からプログラミングの世界に入りました。
            C/C++ で１から作ることも好きですが、最近は変化の激しい IT 業界をみて Web 系にシフトしつつあります。
          </p>
        </div>
      </div>
    </div>
  </article>

    <footer>
  <div>
    2019 Hood<br>
    <a href="https://github.com/blue-hood/apps" target=”_blank”>Published</a> under the MIT license. <br>
    <a href="https://b-hood.site/privacy/">プライバシーポリシー</a>
  </div>
</footer>
    <script src="/js/app.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://b-hood.site/js/social-button.js"></script>
  </body>
</html>
